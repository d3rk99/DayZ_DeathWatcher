<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Memento Mori – Stories</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">
    <script src="public/js/discord-auth.js" defer></script>
</head>
<body>
<header class="site-header">
    <div class="header-inner">
        <h1 class="site-title">Memento Mori</h1>
        <nav class="main-nav">
            <div class="nav-item">
                <a href="index.html" class="nav-link">Home</a>
            </div>
            <div class="nav-item has-dropdown">
                <a href="about.html" class="nav-link">About</a>
                <div class="dropdown">
                    <a href="about.html" class="dropdown-link">About</a>
                    <a href="guide.html" class="dropdown-link">New Survivor Guide</a>
                </div>
            </div>
            <div class="nav-item has-dropdown">
                <a href="seasons.html" class="nav-link">Seasons</a>
                <div class="dropdown">
                    <a href="seasons.html" class="dropdown-link">Season Dashboard</a>
                    <a href="patch-notes.html" class="dropdown-link">Patch Notes</a>
                    <a href="timeline.html" class="dropdown-link">Timeline</a>
                </div>
            </div>
            <div class="nav-item has-dropdown">
                <a href="players.html" class="nav-link active">Players</a>
                <div class="dropdown">
                    <a href="players.html" class="dropdown-link">Players Overview</a>
                    <a href="map.html" class="dropdown-link">Map</a>
                    <a href="stories.html" class="dropdown-link active">Stories</a>
                    <a href="factions.html" class="dropdown-link">Factions</a>
                    <a href="leaderboards.html" class="dropdown-link">Leaderboards</a>
                    <a href="gallery.html" class="dropdown-link">Gallery</a>
                </div>
            </div>
            <div class="nav-item">
                <a href="join.html" class="nav-link">Join</a>
            </div>
            <div class="nav-item has-dropdown">
                <a href="admin.html" class="nav-link">Admins</a>
                <div class="dropdown">
                    <a href="admin.html" class="dropdown-link">Admin Console</a>
                    <a href="admin.html#seasons" class="dropdown-link">Season Admin</a>
                    <a href="admin.html#patch-notes" class="dropdown-link">Patch Notes Admin</a>
                    <a href="admin.html#stories" class="dropdown-link">Stories Admin</a>
                    <a href="admin.html#factions" class="dropdown-link">Factions Admin</a>
                    <a href="admin.html#leaderboards" class="dropdown-link">Leaderboards Admin</a>
                </div>
            </div>
        </nav>
    </div>
</header>
<main>
    <section class="page-hero">
        <div class="section-inner">
            <h2>Player Stories & Hall of Fame</h2>
            <p class="muted">Moments worth remembering. Submit yours, and we’ll feature the legends each season.</p>
        </div>
    </section>

    <section class="panel">
        <div class="section-inner story-layout">
            <div class="featured">
                <div class="card-header">
                    <div>
                        <p class="eyebrow">Story of the Week</p>
                        <h3>“Signal in the Pines” — Vela</h3>
                    </div>
                    <span class="badge badge-hot">Featured</span>
                </div>
                <p class="muted">We tracked the convoy by radio static alone. When the lightning hit the ridge, the bandits froze — that was our window. Three minutes later, we were ghosts.</p>
                <div class="flag-row">
                    <span class="pill">Season 4</span>
                    <span class="pill">Squad</span>
                    <span class="pill">Extraction</span>
                </div>
                <a class="btn btn-outline" href="#">Submit your story</a>
            </div>
            <aside class="hall-of-fame">
                <div class="card-header">
                    <div>
                        <p class="eyebrow">Hall of Fame</p>
                        <h3>Immortalized Survivors</h3>
                    </div>
                </div>
                <ul class="bullet-list">
                    <li><strong>Vela</strong> — Extraction team lead, Season 4.</li>
                    <li><strong>Crane</strong> — Longest life, Season 3.</li>
                    <li><strong>Mara</strong> — Radio ops hero, Season 2.</li>
                </ul>
            </aside>
        </div>
    </section>

    <section class="panel">
        <div class="section-inner">
            <div class="card-header">
                <div>
                    <p class="eyebrow">Published Stories</p>
                    <h3>By Season</h3>
                </div>
                <div class="flag-row">
                    <span class="pill">Filter: Season 5</span>
                    <span class="pill">Status: Published</span>
                </div>
            </div>
            <div class="card-grid">
                <article class="info-card">
                    <h4>“Convoy at Dusk” — Harker</h4>
                    <p class="muted">We shadowed the convoy for four kilometers. When the rain hit, we cut the lights and made our move.</p>
                    <div class="flag-row">
                        <span class="pill">Season 5</span>
                        <span class="pill">PvP</span>
                    </div>
                </article>
                <article class="info-card">
                    <h4>“Snowline” — Yuki</h4>
                    <p class="muted">A solo trek through the white-out from Sitnik to Nadbor with no shots fired.</p>
                    <div class="flag-row">
                        <span class="pill">Season 5</span>
                        <span class="pill">Survival</span>
                    </div>
                </article>
                <article class="info-card">
                    <h4>“Breaker” — Dima</h4>
                    <p class="muted">One battery, one radio tower, one night. The traders heard us and opened the gates.</p>
                    <div class="flag-row">
                        <span class="pill">Season 4</span>
                        <span class="pill">Storyline</span>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <section class="panel">
        <div class="section-inner">
            <h3>Community Stories (API)</h3>
            <div id="story-list" class="story-grid"></div>
            <div class="form-grid">
                <div>
                    <h4>Submit your story</h4>
                    <form id="story-form">
                        <label>Title<input type="text" name="title" required></label>
                        <label>Season ID (optional)<input type="number" name="season_id"></label>
                        <label>Story<textarea name="body_markdown" required></textarea></label>
                        <button type="submit">Submit Story</button>
                        <p class="muted" id="story-status"></p>
                    </form>
                </div>
            </div>
        </div>
    </section>

</main>
<footer class="site-footer">
    <div class="footer-inner">
        <div class="footer-col">
            <h4>Server</h4>
            <ul>
                <li>Region: NA</li>
                <li>Style: Hardcore Survival</li>
                <li>Mode: Seasonal / Story-Driven</li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Links</h4>
            <ul>
                <li><a href="https://discord.gg/your-invite" target="_blank">Discord</a></li>
                <li><a href="join.html">How to Join</a></li>
                <li><a href="about.html">About the Team</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Notes</h4>
            <p>
                Memento Mori is a community-run DayZ server project.
                Not affiliated with or endorsed by Bohemia Interactive.
            </p>
        </div>
    </div>
    <div class="footer-meta">
        <span>&copy; <span id="year"></span> Memento Mori Server</span>
        <span>Last wipe: Seasonal schedule</span>
    </div>
</footer>
<script>
    document.getElementById('year').textContent = new Date().getFullYear();

    async function loadStories() {
        const res = await fetch('/api/stories?status=approved');
        const data = await res.json();
        const list = document.getElementById('story-list');
        if (!list) return;
        list.innerHTML = '';
        data.forEach(story => {
            const card = document.createElement('article');
            card.className = 'story-card';
            card.innerHTML = `<p class="eyebrow">${story.author_name}</p><h3>${story.title}</h3><p>${story.body_markdown}</p>`;
            list.appendChild(card);
        });
    }
    const form = document.getElementById('story-form');
    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const payload = Object.fromEntries(formData.entries());
            payload.season_id = payload.season_id || null;
            const res = await fetch('/api/stories', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });
            const statusEl = document.getElementById('story-status');
            if (res.ok) {
                statusEl.textContent = 'Submitted! Pending approval by admins.';
                form.reset();
                loadStories();
            } else {
                statusEl.textContent = 'Submission failed (login may be required).';
            }
        });
    }
    loadStories();

</script>
</body>
</html>
