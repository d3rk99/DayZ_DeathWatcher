<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Memento Mori – Leaderboards</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">
</head>
<body>
<header class="site-header">
    <div class="header-inner">
        <h1 class="site-title">Memento Mori</h1>
        <nav class="main-nav">
            <div class="nav-item">
                <a href="index.html" class="nav-link">Home</a>
            </div>
            <div class="nav-item has-dropdown">
                <a href="about.html" class="nav-link">About</a>
                <div class="dropdown">
                    <a href="about.html" class="dropdown-link">About</a>
                    <a href="guide.html" class="dropdown-link">New Survivor Guide</a>
                </div>
            </div>
            <div class="nav-item has-dropdown">
                <a href="seasons.html" class="nav-link">Seasons</a>
                <div class="dropdown">
                    <a href="seasons.html" class="dropdown-link">Season Dashboard</a>
                    <a href="patch-notes.html" class="dropdown-link">Patch Notes</a>
                    <a href="timeline.html" class="dropdown-link">Timeline</a>
                </div>
            </div>
            <div class="nav-item has-dropdown">
                <a href="players.html" class="nav-link active">Players</a>
                <div class="dropdown">
                    <a href="players.html" class="dropdown-link">Players Overview</a>
                    <a href="map.html" class="dropdown-link">Map</a>
                    <a href="stories.html" class="dropdown-link">Stories</a>
                    <a href="factions.html" class="dropdown-link">Factions</a>
                    <a href="leaderboards.html" class="dropdown-link active">Leaderboards</a>
                    <a href="gallery.html" class="dropdown-link">Gallery</a>
                </div>
            </div>
            <div class="nav-item">
                <a href="join.html" class="nav-link">Join</a>
            </div>
            <div class="nav-item has-dropdown">
                <a href="admin.html" class="nav-link">Admins</a>
                <div class="dropdown">
                    <a href="admin.html" class="dropdown-link">Admin Console</a>
                    <a href="admin.html#seasons" class="dropdown-link">Season Admin</a>
                    <a href="admin.html#patch-notes" class="dropdown-link">Patch Notes Admin</a>
                    <a href="admin.html#stories" class="dropdown-link">Stories Admin</a>
                    <a href="admin.html#factions" class="dropdown-link">Factions Admin</a>
                    <a href="admin.html#leaderboards" class="dropdown-link">Leaderboards Admin</a>
                </div>
            </div>
        </nav>
    </div>
</header>
<main>
    <section class="page-hero">
        <div class="section-inner">
            <h2>Leaderboards</h2>
            <p class="muted">Live stats straight from the server — updated as players log time.</p>
        </div>
    </section>

    <section class="panel">
        <div class="section-inner">
            <h3>Live Leaderboards (API)</h3>
            <div class="card-grid">
                <article class="info-card">
                    <div class="card-header">
                        <div>
                            <p class="eyebrow">Time Invested</p>
                            <h3>Top 5 Playtime</h3>
                        </div>
                        <span class="badge">Live</span>
                    </div>
                    <table class="styled-table" aria-label="Top playtime leaderboard">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Player</th>
                                <th>Hours Played</th>
                            </tr>
                        </thead>
                        <tbody id="playtime-leaders">
                            <tr><td colspan="3" class="muted">Loading…</td></tr>
                        </tbody>
                    </table>
                </article>
                <article class="info-card">
                    <div class="card-header">
                        <div>
                            <p class="eyebrow">Your Session</p>
                            <h3>Your Playtime</h3>
                        </div>
                        <span class="badge">Discord Login</span>
                    </div>
                    <div id="my-playtime" class="muted">Sign in with Discord to see your tracked time.</div>
                </article>
            </div>
        </div>
    </section>

</main>
<footer class="site-footer">
    <div class="footer-inner">
        <div class="footer-col">
            <h4>Server</h4>
            <ul>
                <li>Region: NA</li>
                <li>Style: Hardcore Survival</li>
                <li>Mode: Seasonal / Story-Driven</li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Links</h4>
            <ul>
                <li><a href="https://discord.gg/your-invite" target="_blank">Discord</a></li>
                <li><a href="join.html">How to Join</a></li>
                <li><a href="about.html">About the Team</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Notes</h4>
            <p>
                Memento Mori is a community-run DayZ server project.
                Not affiliated with or endorsed by Bohemia Interactive.
            </p>
        </div>
    </div>
    <div class="footer-meta">
        <span>&copy; <span id="year"></span> Memento Mori Server</span>
        <span>Last wipe: Seasonal schedule</span>
    </div>
</footer>
<script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const formatHours = (seconds) => {
        const totalSeconds = Number(seconds) || 0;
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        return `${hours}h ${minutes}m`;
    };

    async function loadLeaderboard() {
        const res = await fetch('/api/leaderboards/playtime');
        const data = await res.json();
        const tbody = document.getElementById('playtime-leaders');
        const myPlaytime = document.getElementById('my-playtime');

        if (tbody) {
            tbody.innerHTML = '';
            if (data.leaderboard && data.leaderboard.length) {
                data.leaderboard.forEach((row, idx) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${idx + 1}</td>
                        <td>${row.playerName || row.playerGuid || row.steam64Id || 'Unknown'}</td>
                        <td>${formatHours(row.totalSeconds)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="3" class="muted">No playtime recorded yet.</td>';
                tbody.appendChild(tr);
            }
        }

        if (myPlaytime) {
            if (data.me) {
                myPlaytime.classList.remove('muted');
                myPlaytime.innerHTML = `
                    <div class="stat">
                        <div class="stat-number">${formatHours(data.me.totalSeconds)}</div>
                        <div class="stat-label">Tracked as ${data.me.playerName || 'Unknown Survivor'}</div>
                    </div>
                `;
            } else {
                myPlaytime.classList.add('muted');
                myPlaytime.textContent = 'Sign in with Discord to view your personal playtime.';
            }
        }
    }
    loadLeaderboard();

</script>
</body>
</html>
